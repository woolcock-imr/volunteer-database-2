<div id=page__ID>
	<div id=panel__ID class="container-fluid" style='max-width:1000px'>
		<div class="text-left panel__ID">
			<h3>Registration Form</h3>
    	  	  <hr style='border-top:1px solid #fff;'></hr>
              <div class="row row__ID">
                  <div class="col-sm control-group" >
                      Email
                      <input class="form-control" type=email id=Email__ID placeholder='Email (this will be used as you login)' />
                      Password
                      <input  class="form-control" type=password id=Registration_Password__ID placeholder="Password" />
                      First Name
                      <input type="text" class="form-control" id="First_Name__ID" name="First_Name__ID" placeholder="First Name">
                      Last Name
                      <input type="text" class="form-control" id="Last_Name__ID" name="Last_Name__ID" placeholder="Last Name">
                      Phone
                      <input type="text" class="form-control" id=Phone__ID name="Phone__ID" placeholder="Phone">
                      Postcode
                      <input type="text" class="form-control" id=Postcode__ID name="Postcode__ID" placeholder="Postcode">
                      Gender
                      <select class="form-control" id=Gender__ID Name=Gender__ID placeholder="Gender">
                          <option value='' >...</option>
                          <option value='Male' >Male</option>
                          <option value='Female' >Female</option>
                          <option >Indeterminate/Intersex/Unspecified</option>
                      </select>
                      Year of Birth
                      <input type="text" class="form-control" id=Year_of_Birth__ID name="Year_of_Birth__ID" placeholder="Year of Birth (YYYY)">

                  </div>

                  <div class="col-sm control-group">
                      <label class="control control-checkbox"><span id=xquest__ID>I would like to participate in medical research and agree to be contacted for more information</span>
                          <input type="checkbox" name="Medical_Research" id=Medical_Research__ID value='medical research'>
                          <div class="control_indicator"></div>
                      </label>
                      <label class="control control-checkbox"> <span id=xquest__ID>I would like to receive updates, including the latest medical findings and break-throughs in respiratory and sleep research, from the Woolcock Institute</span>
                              <input type="checkbox"  name="Newsletters" id=Newsletters__ID value='newsletters' >
                          <div class="control_indicator"></div>
                      </label>
                      <span id=quest__ID ><br>Have you been diagnosed with, or think you have?</span>
                      <label class="control control-checkbox">Asthma
                          <input type="checkbox"  name="Asthma" value="Asthma" />
                          <div class="control_indicator"></div>
                      </label>
                      <label class="control control-checkbox">COPD (Chronic Obstructive Pulmonary Disease)
                          <input type="checkbox"  name="COPD" value="COPD" />
                          <div class="control_indicator"></div>
                      </label>
                      <label class="control control-checkbox">Chronic Bronchitis
                          <input type="checkbox"  name="Chronic_Bronchitis" value="Chronic Bronchitis" />
                          <div class="control_indicator"></div>
                      </label>
                      <label class="control control-checkbox">Emphysema
                          <input type="checkbox"  name="Emphysema" value="Emphysema" />
                          <div class="control_indicator"></div>
                      </label>
                      <label class="control control-checkbox">Rhinitis
                          <input type="checkbox"  name="Rhintis" value="Rhintis" />
                          <div class="control_indicator"></div>
                      </label>
                      <label class="control control-checkbox">Lung Cancer
                          <input type="checkbox"  name="Lung_Cancer" value="Lung Cancer" />
                          <div class="control_indicator"></div>
                      </label>
                      <label class="control control-checkbox">Insomnia
                          <input type="checkbox"  name="Insomnia" value="Insomnia"/>
                          <div class="control_indicator"></div>
                      </label>
                      <label class="control control-checkbox">Narcolepsy
                          <input type="checkbox"  name="Narcolepsy" value="Narcolepsy"/>
                          <div class="control_indicator"></div>
                      </label>
                      <label class="control control-checkbox">OSA (Obstructive Sleep Apnoea)
                          <input type="checkbox"  name="OSA" value="OSA" />
                          <div class="control_indicator"></div>
                      </label>
                      <label class="control control-checkbox">RLS (Restless Leg Syndrome)
                          <input type="checkbox"  name="RLS" value=RLS />
                          <div class="control_indicator"></div>
                      </label>

                  </div>
              </div>
              <input class="btn btn-primary btn-lg" type=button id=submit__ID value="Register" />
		</div>
        <div style='text-align:center;font-size:8pt'>
            <br>
            The Woolcock Institute of Medical Research recognises the importance of your personal information and privacy. <br>
            We will use your provided details only to contact you about information we believe will be of interest to you. <br>
            <a href="https://static1.squarespace.com/static/515ba920e4b0afec12175c59/t/59f019fa29f187a715e74ca6/1508907516135/PrivacyPolicy.pdf" target="_blank" >Click here to read our full Privacy Policy.</a>
        </div>
	</div>

</div>
<script>
    function F__ID(){
        //----------------------------------------
		$('#panel__ID').on('click', function(event){
		    if(event.ctrlKey){
				var x=document.getElementById("panel__ID");
				var txt="";var nm0="";
				for (var i=0; i < x.length; i++) {
					var nm=x.elements[i].getAttribute("name");
					if(nm!=null && nm!=nm0){ if(txt!="") txt+=", "; txt+=nm; nm0=nm;}
				}
				$vm.alert(txt)
		    }
		});
		//--------------------------------------------------------
        $('#D__ID').on('load',function(){
            //$('#F__ID')[0].reset();
        })
        //-------------------------------------
        $('#submit__ID').on('click',function(){
            var record={}
            record.First_Name=$('#First_Name__ID').val();
            record.Last_Name=$('#Last_Name__ID').val();
            record.Phone=$('#Phone__ID').val();
            record.Postcode=$('#Postcode__ID').val();
            record.Email=$('#Email__ID').val();
            record.Gender=$('#Gender__ID').val();
            record.Year_of_Birth=$('#Year_of_Birth__ID').val();

            if($('#Asthma__ID').is(':checked'))             record.Asthma="1"; else record.Asthma='0'
            if($('#COPD__ID').is(':checked'))               record.COPD="1"; else record.COPD='0'
            if($('#Chronic_Bronchitis__ID').is(':checked')) record.Chronic_Bronchitis="1"; else record.Chronic_Bronchitis='0'
            if($('#Emphysema__ID').is(':checked'))          record.Emphysema="1"; else record.Emphysema='0'
            if($('#Rhintis__ID').is(':checked'))            record.Rhintis="1"; else record.Rhintis='0'
            if($('#Lung_Cancer__ID').is(':checked'))        record.Lung_Cancer="1"; else record.Lung_Cancer='0'
            if($('#Insomnia__ID').is(':checked'))           record.Insomnia="1"; else record.Insomnia='0'
            if($('#Narcolepsy__ID').is(':checked'))         record.Narcolepsy="1"; else record.Narcolepsy='0'
            if($('#OSA__ID').is(':checked'))                record.OSA="1"; else record.OSA='0'
            if($('#RLS__ID').is(':checked'))                record.RLS="1"; else record.RLS='0'
            if($('#Medical_Research__ID').is(':checked'))   record.Medical_Research="1"; else record.Medical_Research='0'
            if($('#Newsletters__ID').is(':checked'))        record.Newsletters="1"; else record.Newsletters='0'
            if($('#Medical_Research__ID').is(':checked')==true) {
                if($('#First_Name__ID').val()===''){
                    $vm.alert("First Name is compulsory");
                    return;
                }
                if($('#Last_Name__ID').val()===''){
                    $vm.alert("Last Name is compulsory");
                    return;
                }
                if($('#Phone__ID').val()===''){
                    $vm.alert("Phone is compulsory");
                    return;
                }
                if($('#Postcode__ID').val()===''){
                    $vm.alert("Postcode is compulsory");
                    return;
                }
                var re=/^(\d{4})$/;
                if(re.test($('#Postcode__ID').val())===false){
                    $vm.alert("Post code: 4 digits Please");
                    return;
                }
                if($('#Gender__ID').val()===''){
                    $vm.alert("Gender is compulsory");
                    return;
                }
                if($('#Year_of_Birth__ID').val()===''){
                    $vm.alert("Year of Birth is compulsory");
                    return;
                }
                var re=/^(\d{4})$/;
                if(re.test($('#Year_of_Birth__ID').val())===false){
                    $vm.alert("Year of Birth: 4 digits please");
                    return;
                }

            }
            if($('#Email__ID').val()===''){
                $vm.alert("Email is compulsory");
                return;
            }
            var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            if(re.test($('#Email__ID').val())===false){
                $vm.alert("Invalid email format");
                return;
            }
            if($('#Registration_Password__ID').val()===''){
                $vm.alert("Password is compulsory");
                return;
            }
            if($('#Medical_Research__ID').is(':checked')==false && $('#Newsletters__ID').is(':checked')==false){
                $vm.alert("Please select one or both of the check boxes at the top of the registration page.  This gives us your consent to send a newsletter or contact you about our research.");
                return;
            };
            var dbv={};
            dbv.S1=$('#Email__ID').val();
            dbv.S2=$('#Email__ID').val();
            dbv.ES3=$('#Registration_Password__ID').val();

			dbv.DT1=$('#Year_of_Birth__ID').val()+"-01-01";
			dbv.B1=record.Medical_Research;
			var g1=0; if(record.Gender=='Male') g1=1;
			var g2=0; if(record.Gender=='Female') g2=1;
			var s=parseInt(record.Asthma)+2*parseInt(record.COPD)+4*parseInt(record.Chronic_Bronchitis)+8*parseInt(record.Emphysema)+16*parseInt(record.Rhintis);
			s+=32*parseInt(record.Lung_Cancer)+64*parseInt(record.Insomnia)+128*parseInt(record.Narcolepsy)+256*parseInt(record.OSA)+512*parseInt(record.RLS)+1024*parseInt(g1)+2048*parseInt(g2);
			dbv.V1=s;
			dbv.V2=record.Postcode;

			var req={cmd:"s1_s2_exist",db_pid:'20008533',s1:dbv.S1,s2:dbv.S2};
            $VmAPI.request({data:req,callback:function(res){
                if(res.ret==='0'){
                    var req={cmd:"add_record",db_pid:'20008533',data:record,dbv:dbv}; //geust can add
                    $VmAPI.request({data:req,callback:function(res){
                        send_email();
                        if($('#Newsletters__ID').is(':checked')==true & $('#Medical_Research__ID').is(':checked')==false){
                            $vm.load_module_by_name('woolcock_volunteer_database_thankyou',$vm.root_layout_content_slot,{});
                        }
                        else{
                            //copy username and password to the signin section and trigger a click
                            $('#username__ID').val($('#Email__ID').val());
                            $('#password__ID').val($('#Registration_Password__ID').val());
                            $('#signin__ID').triggerHandler('click');
                        }
                    }});
                }
                else{
                    alert('The username or email already exists.')
                }
            }});
        })
        //-------------------------------------
        var send_email=function(){
            var From_Address="noresponse@woolcock.org.au";
            var From_Name="Woolcock Institute of Medical Research";
            var To=$('#Email__ID').val();
            var Title="Registration";
            var Body="Thank you for registering and welcome to the Woolcock family!<br><br>";
            Body+="You can update your details at any time by visiting <a href='https://rt.woolcock.org.au/volunteer-database.html'>https://rt.woolcock.org.au/volunteer-database.html</a><br><br>";
            Body+="For more information about Woolcock please visit our website.<br>";
            Body+='<a href="http://woolcock.org.au/">woolcock.org.au</a><br><br>';
            Body+='<p class=MsoNormal><a href="http://woolcock.org.au/"><b><span style="font-family:"Arial","sans-serif";color:#E31937;text-decoration:none"><img border=0 width=262 id="Picture 6" src="http://static1.squarespace.com/static/515ba920e4b0afec12175c59/t/524a1887e4b05a2438113f89/1452662918547/?format=262w"></span></b></a></p>';
            $VmAPI.request({data:{cmd:'send_email',From_Address:From_Address,From_Name:From_Name,To:To,Title:Title,Body:Body},callback:function(res){
                //alert('Email to: '+$('#Email__ID').val()+' has been sent');
				//if($vm.module_afetr_signin!=undefined && $vm.module_afetr_signin!='') $vm.nav_load_module($vm.module_afetr_signin);
				$vm.nav_load_module('panel_main_signin');
            }})

        }
    }
</script>
<style>
#D__ID{
	height:100%;
	overflow:auto;
	animation: vm_module_fadein 1.0s;
	background:rgba(255,255,255,0.2);
}
	#page__ID{
		height:100%;
		display: flex;
		align-items: center;
	}
	.panel__ID{
		color:#000;
		font-weight: normal;
		background: rgba(255,255,255,0.8);
		padding: 30px 20px 10px 20px;
		border-radius: 15px;
	}
	@media screen and (max-width:786px){
		#page__ID{
			display: block;
		}
	}
    #panel__ID li{
		cursor:pointer;
	}
    .control {
        font-family: arial;
        display: block;
        position: relative;
        padding-left: 30px;
        margin-bottom: 5px;
        padding-top: 3px;
        cursor: pointer;
        font-size: 16px;
    }
    .control {
        font-family: arial;
        display: block;
        position: relative;
        padding-left: 30px;
        margin-bottom: 5px;
        padding-top: 3px;
        cursor: pointer;
        font-size: 16px;
    }
        .control input {
            position: absolute;
            z-index: -1;
            opacity: 0;
        }
    .control_indicator {
        position: absolute;
        top: 2px;
        left: 0;
        height: 20px;
        width: 20px;
        background: #e6e6e6;
        border: 1px solid #000000;
    }
    .control-radio .control_indicator {
        border-radius: 50%;
    }
    .control:hover input ~ .control_indicator,
    .control input:focus ~ .control_indicator {
        background: #cccccc;
    }

    .control input:checked ~ .control_indicator {
        background: #A51C3D;
    }
    .control:hover input:not([disabled]):checked ~ .control_indicator,
    .control input:checked:focus ~ .control_indicator {
        background: #0e6647d;
    }
    .control input:disabled ~ .control_indicator {
        background: #e6e6e6;
        opacity: 0.6;
        pointer-events: none;
    }
    .control_indicator:after {
        box-sizing: unset;
        content: '';
        position: absolute;
        display: none;
    }
    .control input:checked ~ .control_indicator:after {
        display: block;
    }
    .control-radio .control_indicator:after {
        left: 7px;
        top: 7px;
        height: 0px;
        width: 0px;
        border-radius: 50%;
        background: #ffffff;
    }
    .control-radio input:disabled ~ .control_indicator:after {
        background: #7b7b7b;
    }
    .control-checkbox .control_indicator {
        border-radius: 10%;
    }
    .control-checkbox .control_indicator:after {
        left: 8px;
        top: 4px;
        width: 3px;
        height: 8px;
        border: solid #ffffff;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
    }
    .control-checkbox input:disabled ~ .control_indicator:after {
        border-color: #7b7b7b;
    }

</style>
